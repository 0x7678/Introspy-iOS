<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">

<html lang="en">
<head>
  <title>Introspy HTML Report</title>

  <!-- Bootstrap, handlebars.js and jquery -->
  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <script src="handlebars.js" type="text/javascript"></script>
  <script src="jquery.min.js" type="text/javascript"></script>

  <!-- Handlebar.js template to display a list of tracedCalls -->
  <script id="tracedCalls-template" type="text/x-handlebars-template">
  <ol class="call_list">
    {{#each calls}}
      <div class="{{toHTMLClassAttr this.group}} {{toHTMLClassAttr this.subgroup}}">
      <h4><li>{{this.clazz}} {{this.method}}</li></h4>
      <div>
      Arguments: <pre>{{printArguments this.argsAndReturnValue}}</pre>
      Return Value: <pre>{{printReturnValue this.argsAndReturnValue}}</pre>
      </div>
      </div>
    {{/each}}
  </ol>
  </script>

  <!-- Handlebar.js template to display the findings -->
  <script id="findings-template" type="text/x-handlebars-template">
  <div class="findings_list">
    {{#each findings}}
      <h4>{{signature.group}} {{signature.name}} - Severity: {{signature.severity}} </h4>
      <div>
      <p>{{signature.description}}</p>
      {{> tracedCalls}}
      </div>
    {{/each}}
  <div>
  </script>

  <!-- Handlebar.js template for the show/hide bar -->
  <script id="showHide-template" type="text/x-handlebars-template">
    <div class="btn-group">
      {{#each groups}}
        <button id="toggle-{{toHTMLClassAttr name}}" onclick="javascript:$('.{{toHTMLClassAttr name}}).toggle()">{{name}}</button>
      {{/each}}
    </div>
  </script>

  <!-- Import data generated by the Analyzer -->
  <script src="tracedCalls.js" type="text/javascript"></script>
  <script src="findings.js" type="text/javascript"></script>
  <script src="apiGroups.js" type="text/javascript"></script>

</head>

<body>
  <script src="bootstrap/js/bootstrap.min.js"></script>


  <!-- Actual Page -->
  <!-- Navigation bar -->
  <div class="tabbable">
  <div id="showhidebar"></div>
  <ul class="nav nav-tabs">
  <li class="active"><a href="#tab1" data-toggle="tab">Traced Calls</a></li>
  <li><a href="#tab2" data-toggle="tab">Findings</a></li>
  </ul>
  <div class="tab-content">
  <!-- Actual content of tab1: list of traced calls -->
  <div class="tab-pane active" id="tab1">
  <p>I'm in Section 1.</p>
  </div>
  <!-- Actual content of tab2: list of vulnerabilities -->
  <div class="tab-pane" id="tab2">
  <p>Howdy, I'm in Section 2.</p>
  </div>
  </div>
  </div>
  <!-- Page End -->

    <!-- Populate the page with content -->
  <script type="text/javascript">

  // Compile the templates
  var tracedCallsTemplate = Handlebars.compile($("#tracedCalls-template").html());
  // Register this template as partial so we can reuse it when printing the findings
  Handlebars.registerPartial("tracedCalls", tracedCallsTemplate);

  var findingsTemplate = Handlebars.compile($("#findings-template").html());

  var showHideTemplate = Handlebars.compile($("#showHide-template").html());

  // Handlers used by the templates
  Handlebars.registerHelper('printArguments', function(argsAndReturnValue) {
    // Pretty print JSON
    return JSON.stringify(argsAndReturnValue.arguments, undefined, 2);
  });
  Handlebars.registerHelper('printReturnValue', function(argsAndReturnValue) {
    return JSON.stringify(argsAndReturnValue.returnValue, undefined, 2);
  });
  function toHTMLClassAttr(name) {
    // Remove spaces so it's a valid class HTML attribute
    return name.toLowerCase().replace(/\s/g,'');
  }
  Handlebars.registerHelper('toHTMLClassAttr', function(groupname) {
    return toHTMLClassAttr(groupname);
  });

  // Populate tab1 with the traced calls
  document.getElementById("tab1").innerHTML = tracedCallsTemplate(tracedCalls);

  // Populate tab2 with the findings
  document.getElementById("tab2").innerHTML = findingsTemplate(findings);

  // Populate the show hide bars with API groups
  document.getElementById("showhidebar").innerHTML = showHideTemplate(apiGroups);
  </script>
</body>
</html>
