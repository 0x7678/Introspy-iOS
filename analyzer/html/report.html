<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">

<html lang="en">
<head>
  <title>Introspy HTML Report</title>

  <!-- Bootstrap, handlebars.js and jquery -->
  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <script src="handlebars.js" type="text/javascript"></script>
  <script src="jquery.min.js" type="text/javascript"></script>

  <!-- Handlebar.js template to display the tracedCalls -->
  <script id="tracedCalls-template" type="text/x-handlebars-template">
  <ol class="call_list">
    {{#each calls}}
      <h4><li>{{this.clazz}} {{this.method}}</li></h4>
      <div>
      Arguments: <pre>{{printArguments this.argsAndReturnValue}}</pre>
      Return Value: <pre>{{printReturnValue this.argsAndReturnValue}}</pre>
      </div>
    {{/each}}
  </ol>
  </script>

  <!-- Handlebar.js template to display the findings -->
  <script id="findings-template" type="text/x-handlebars-template">
  <div class="findings_list">
    {{#each findings}}
      <h4>{{signature.group}} {{signature.title}} - {{signature.severity}} </h4>
      <div>
      <p>{{signature.description}}</p>
      {{> tracedCalls}}
      </div>
    {{/each}}
  <div>
  </script>

  <!-- Import the traced calls and findings-->
  <script src="tracedCalls.js" type="text/javascript"></script>
  <script src="findings.js" type="text/javascript"></script>

</head>

<body>
  <script src="bootstrap/js/bootstrap.min.js"></script>

  <!-- Navigation bar -->
  <div class="tabbable">
  <ul class="nav nav-tabs">
  <li class="active"><a href="#tab1" data-toggle="tab">Traced Calls</a></li>
  <li><a href="#tab2" data-toggle="tab">Findings</a></li>
  </ul>
  <div class="tab-content">
  <!-- Actual content of tab1: list of traced calls -->
  <div class="tab-pane active" id="tab1">
  <p>I'm in Section 1.</p>
  </div>
  <!-- Actual content of tab2: list of vulnerabilities -->
  <div class="tab-pane" id="tab2">
  <p>Howdy, I'm in Section 2.</p>
  </div>
  </div>
  </div>

    <!-- Populate the page with content -->
  <script type="text/javascript">

  // Prepare the templates
  var source   = $("#tracedCalls-template").html();
  var tracedCallsTemplate = Handlebars.compile(source);
  // Register this template as partial so we can reuse it when printing the findings
  Handlebars.registerPartial("tracedCalls", tracedCallsTemplate);

  var source   = $("#findings-template").html();
  var findingsTemplate = Handlebars.compile(source);

  Handlebars.registerHelper('printArguments', function(argsAndReturnValue) {
  return JSON.stringify(argsAndReturnValue.arguments, undefined, 2);
  });

  Handlebars.registerHelper('printReturnValue', function(argsAndReturnValue) {
  return JSON.stringify(argsAndReturnValue.returnValue, undefined, 2);
  });

  // Populate tab1 with the traced calls
  var content = document.getElementById("tab1");
  content.innerHTML = tracedCallsTemplate(tracedCalls);

  // Populate tab2 with the findings
  var content2 = document.getElementById("tab2");
  content2.innerHTML = findingsTemplate(findings);

  </script>
</body>
</html>
