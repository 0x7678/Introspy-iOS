<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN">

<html lang="en">
<head>
  <title>Introspy HTML Report</title>

  <!-- Bootstrap, handlebars.js and jquery -->
  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <script src="handlebars.js" type="text/javascript"></script>
  <script src="jquery.min.js" type="text/javascript"></script>

  <!-- Handlebar.js template to display a list of tracedCalls -->
  <script id="tracedCalls-template" type="text/x-handlebars-template">
  <ul id="calls_list">
    {{#each calls}}
      <li class="{{toHTMLClassAttr this.group}} {{toHTMLClassAttr this.subgroup}}">
      <h5>{{this.callId}}: {{this.clazz}} {{this.method}}</h5>
      <div>
      Arguments: <pre>{{printArguments this.argsAndReturnValue}}</pre>
      Return Value: <pre>{{printReturnValue this.argsAndReturnValue}}</pre>
      </div>
      </li>
    {{/each}}
  </ul>
  </script>

  <!-- Handlebar.js template to display the findings -->
  <script id="findings-template" type="text/x-handlebars-template">
  <ul id="findings_list">
    {{#each findings}}
      <li class="{{toHTMLClassAttr signature.group}} {{toHTMLClassAttr signature.subgroup}}">
        <h4>{{signature.title}}</h4>
        <h5>Severity: {{signature.severity}}</h5>
        <h5 style="display: inline-block">Description:&nbsp;</h5><p style="display: inline-block">{{signature.description}}</p>
        <h5>Relevant function calls:</h5>
        {{> tracedCalls}}
      </li>
    {{/each}}
  </ul>
  </script>

  <!-- Handlebar.js template for the show/hide bar -->
  <script id="showHide-template" type="text/x-handlebars-template">
    <div class="btn-group">
      {{#each groups}}
        <button onclick="$('.{{toHTMLClassAttr name}}').toggle();">{{name}}</button>
      {{/each}}
    </div>
  </script>

  <!-- Import data generated by the Analyzer -->
  <script src="tracedCalls.js" type="text/javascript"></script>
  <script src="findings.js" type="text/javascript"></script>
  <script src="apiGroups.js" type="text/javascript"></script>

</head>

<body>
  <script src="bootstrap/js/bootstrap.min.js"></script>


  <!-- Actual Page -->
  <!-- Show/hide bar -->
  <div id="showhidebar" style="position: fixed;"></div>
  <!-- Navigation bar -->
  <div class="tabbable">
  <ul class="nav nav-tabs" style="margin-top: 20px;">
  <li class="active"><a href="#tab1" data-toggle="tab">Traced Calls</a></li>
  <li><a href="#tab2" data-toggle="tab">Findings</a></li>
  </ul>
  <div class="tab-content">
  <!-- Actual content of tab1: list of traced calls -->
  <div class="tab-pane active" id="tab1">
  <h3>List of traced function calls</h3>
  <div id="tab1content"></div>
  </div>
  <!-- Actual content of tab2: list of vulnerabilities -->
  <div class="tab-pane" id="tab2">
  <h3>List of findings</h3>
  <div id="tab2content"></div>
  </div>
  </div>
  </div>
  <!-- Page End -->

    <!-- Populate the page with content -->
  <script type="text/javascript">

  // Compile the templates
  var tracedCallsTemplate = Handlebars.compile($("#tracedCalls-template").html());
  // Register this template as partial so we can reuse it when printing the findings
  Handlebars.registerPartial("tracedCalls", tracedCallsTemplate);

  var findingsTemplate = Handlebars.compile($("#findings-template").html());

  var showHideTemplate = Handlebars.compile($("#showHide-template").html());

  // Handlers used by the templates
  Handlebars.registerHelper('printArguments', function(argsAndReturnValue) {
    // Pretty print JSON
    return JSON.stringify(argsAndReturnValue.arguments, undefined, 2);
  });
  Handlebars.registerHelper('printReturnValue', function(argsAndReturnValue) {
    return JSON.stringify(argsAndReturnValue.returnValue, undefined, 2);
  });
  function toHTMLClassAttr(attrValue) {
    // Remove spaces so it's a valid class HTML attribute
    return attrValue.toLowerCase().replace(/\s/g,'');
  }
  Handlebars.registerHelper('toHTMLClassAttr', function(groupname) {
    return toHTMLClassAttr(groupname);
  });

  // Populate tab1 with the traced calls
  document.getElementById("tab1content").innerHTML = tracedCallsTemplate(tracedCalls);

  // Populate tab2 with the findings
  document.getElementById("tab2content").innerHTML = findingsTemplate(findings);

  // Populate the show hide bars with API groups
  document.getElementById("showhidebar").innerHTML = showHideTemplate(apiGroups);
  </script>
</body>
</html>
